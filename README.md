# MRZ Scanner: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (SPA) –Ω–∞ Nuxt 3 –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –º–∞—à–∏–Ω–æ—á–∏—Ç–∞–µ–º—ã—Ö –∑–æ–Ω (MRZ) –ø–∞—Å–ø–æ—Ä—Ç–æ–≤ (TD-3) –∏ ID-–∫–∞—Ä—Ç (TD-1). –í—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

## ÔøΩ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

*   **[Nuxt 3](https://nuxt.com/)**: –§—Ä–µ–π–º–≤–æ—Ä–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Vue 3 + Vite).
*   **[Tesseract.js v5+](https://github.com/naptha/tesseract.js)**: OCR –¥–≤–∏–∂–æ–∫ (WASM). –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ Web Worker'–µ.
*   **[PDF.js](https://github.com/mozilla/pdf.js)**: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ PDF-—Ñ–∞–π–ª–æ–≤ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (Canvas) –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Tesseract.
*   **TypeScript**: –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞.

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∞ –≤ `app/pages/index.vue`.

### 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: –ß–∏—Ç–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `FileReader`.
- **PDF**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `pdfjs-dist`.
    - **–í–∞–∂–Ω–æ**: Worker –¥–ª—è PDF.js –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ CDN (`cdnjs`) –≤ `app.vue` (`onMounted`), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å –±–∞–Ω–¥–ª–∏–Ω–≥–æ–º worker'–æ–≤ –≤ Vite/Nuxt.
    - PDF —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤ Canvas —Å –º–∞—Å—à—Ç–∞–±–æ–º **2.0** –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —á–µ—Ç–∫–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ OCR.

### 2. OCR (Tesseract)
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è worker —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
  - `OEM.LSTM_ONLY`: –†–µ–∂–∏–º LSTM (–±—ã—Å—Ç—Ä–µ–µ –∏ —Ç–æ—á–Ω–µ–µ –¥–ª—è —Å—Ç—Ä–æ–∫).
  - `PSM.SINGLE_BLOCK`: –†–µ–∂–∏–º —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º –±–ª–æ–∫ —Ç–µ–∫—Å—Ç–∞).
  - **Whitelist**: `ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789<` (—Ç–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª—ã MRZ).

### 3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ –û—á–∏—Å—Ç–∫–∞ (`extractMrzFromText` / `cleanMrzLine`)
–ü–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏, —Ç–∞–∫ –∫–∞–∫ Tesseract —á–∞—Å—Ç–æ –ø—É—Ç–∞–µ—Ç —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã MRZ (`<`) —Å –±—É–∫–≤–∞–º–∏ (`C`, `K`, `L`, `S`).

**–ê–ª–≥–æ—Ä–∏—Ç–º –æ—á–∏—Å—Ç–∫–∏ (`cleanMrzLine`):**
1.  **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞**:
    - `P[SLCK]...` -> `P<...` (–∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç `PSKGZ` -> `P<KGZ`).
    - `I[SLCK]...` -> `I<...` (–¥–ª—è ID –∫–∞—Ä—Ç).
2.  **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π**:
    - `NAME<C...` -> `NAME<<...` (–∑–∞–º–µ–Ω—è–µ—Ç `C`, `L` –ø–æ—Å–ª–µ `<` –Ω–∞ `<`).
3.  **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö–≤–æ—Å—Ç–æ–≤**:
    - `...LLLLK` -> `...<<<<<` (—à—É–º –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ —Ñ–∏–ª–ª–µ—Ä—ã).
4.  **Padding (–î–æ–±–∏–≤–∫–∞ –¥–ª–∏–Ω—ã)**:
    - –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ TD-3 (Passport) —Ä–∞—Å–ø–æ–∑–Ω–∞–ª–∞—Å—å –∫–∞–∫ 42 —Å–∏–º–≤–æ–ª–∞ –≤–º–µ—Å—Ç–æ 44, –æ–Ω–∞ –¥–æ–±–∏–≤–∞–µ—Ç—Å—è —Å–ø—Ä–∞–≤–∞ —Å–∏–º–≤–æ–ª–∞–º–∏ `<`.
    - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è TD-1 (30 —Å–∏–º–≤–æ–ª–æ–≤).

### 4. –ü–∞—Ä—Å–∏–Ω–≥ –∏ –í–∞–ª–∏–¥–∞—Ü–∏—è (`parseTD3`, `parseTD1`)
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø–∞—Ä—Å–µ—Ä (—Ñ—É–Ω–∫—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ `processMrz`), —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç **ICAO 9303**.

- **Sliding Window**: –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∏ —Å–∫–ª–µ–µ–Ω—ã –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –º—É—Å–æ—Ä, –∞–ª–≥–æ—Ä–∏—Ç–º –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã (44 –∏–ª–∏ 30), –ø—ã—Ç–∞—è—Å—å –Ω–∞–π—Ç–∏ –≤–∞–ª–∏–¥–Ω—ã–π –±–ª–æ–∫.
- **–ê–ª–≥–æ—Ä–∏—Ç–º 7-3-1**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º.
    - –í–µ—Å–∞: `7, 3, 1` (–ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è).
    - –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è: –ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞, –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è, –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è.
    - **Composite Check**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Å—Ä–∞–∑—É (–ø–æ—Å–ª–µ–¥–Ω—è—è —Ü–∏—Ñ—Ä–∞ –≤–æ –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ–∫–µ TD-3).

### 5. –í—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö (`UnifiedMrzResult`)
–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ –µ–¥–∏–Ω–æ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞:

```typescript
interface UnifiedMrzResult {
    document_type: 'PASSPORT' | 'ID_CARD'
    document_number: string
    nationality: string // ICAO –∫–æ–¥ (3 –±—É–∫–≤—ã)
    birth_date: string // YYYY-MM-DD
    sex: 'M' | 'F'
    expiry_date: string // YYYY-MM-DD
    names: {
        surname: string
        given_names: string
    }
    verification_status: 'VALID' | 'INVALID' // –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ 7-3-1
    errors?: string[] // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    raw_lines?: string[] // –°—ã—Ä—ã–µ —Å—Ç—Ä–æ–∫–∏ OCR (–¥–ª—è –¥–µ–±–∞–≥–∞)
    cleaned_lines?: string[] // –°—Ç—Ä–æ–∫–∏ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ (–¥–ª—è –¥–µ–±–∞–≥–∞)
}
```

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

1.  **PDF Worker**: –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –æ—à–∏–±–∫–∏ `Setting up fake worker`, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å CDN —Å—Å—ã–ª–∫–∏ –≤ `app.vue`.
2.  **–¢–æ—á–Ω–æ—Å—Ç—å OCR**: –°–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞ —Ñ–æ—Ç–æ. –ì—Ä—è–∑–Ω—ã–µ/–±–ª–∏–∫—É—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –¥–∞–≤–∞—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ `cleanMrzLine` –Ω–µ –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç –∏—Å–ø—Ä–∞–≤–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—É—Ç–∞–Ω–∏—Ü–∞ `8` –∏ `B` –≤ –Ω–æ–º–µ—Ä–µ).

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
yarn install
yarn dev
```
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ `http://localhost:3000`.
